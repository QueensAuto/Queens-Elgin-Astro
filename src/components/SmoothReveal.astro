---
/**
 * SmoothReveal - Premium scroll-based reveal animations
 *
 * Features slow, elegant slide-up animations with ease-in timing.
 * Handles both full page loads AND Astro View Transitions navigation.
 */
---

<script is:inline>
    (function () {
        "use strict";

        function init() {
            var sections = document.querySelectorAll("[data-reveal]");
            var viewportHeight = window.innerHeight;

            // Progressive enhancement: Set initial hidden states via JS
            sections.forEach(function (section) {
                if (section.dataset.revealed === "true") return;

                var children = section.querySelectorAll("[data-reveal-item]");
                children.forEach(function (child) {
                    child.style.opacity = "0";
                    child.style.transform = "translateY(40px)";
                });
            });

            // Animate sections already in view (hero area)
            sections.forEach(function (section) {
                if (section.dataset.revealed === "true") return;

                var rect = section.getBoundingClientRect();
                if (rect.top < viewportHeight * 0.9) {
                    section.dataset.revealed = "true";
                    // Section is in initial viewport - animate with delay
                    setTimeout(function () {
                        section.classList.add("reveal-visible");

                        var children =
                            section.querySelectorAll("[data-reveal-item]");
                        children.forEach(function (child, index) {
                            setTimeout(function () {
                                child.style.opacity = "1";
                                child.style.transform = "translateY(0)";
                                child.classList.add("reveal-item-animate");
                            }, index * 250);
                        });
                    }, 200);
                }
            });

            // Create observer for scroll-based reveals
            var observer = new IntersectionObserver(
                function (entries) {
                    entries.forEach(function (entry) {
                        if (
                            entry.isIntersecting &&
                            entry.target.dataset.revealed !== "true"
                        ) {
                            var section = entry.target;
                            section.dataset.revealed = "true";
                            section.classList.add("reveal-visible");

                            var children =
                                section.querySelectorAll("[data-reveal-item]");
                            children.forEach(function (child, index) {
                                setTimeout(function () {
                                    child.style.opacity = "1";
                                    child.style.transform = "translateY(0)";
                                    child.classList.add("reveal-item-animate");
                                }, index * 250);
                            });

                            observer.unobserve(entry.target);
                        }
                    });
                },
                {
                    threshold: 0.1,
                    rootMargin: "0px 0px -50px 0px", // Reduced from -100px for reliability
                },
            );

            // Observe all reveal sections that haven't been revealed yet
            sections.forEach(function (section) {
                if (section.dataset.revealed !== "true") {
                    observer.observe(section);
                }
            });
        }

        // Run on initial page load
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", function () {
                init();
            });
        } else {
            init();
        }

        // Run after Astro View Transitions navigation
        document.addEventListener("astro:page-load", function () {
            init();
        });
    })();
</script>
